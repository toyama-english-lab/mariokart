<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Voice Game with Sentences</title>
<style>
  body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: #000;
    color: white;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
  }
  #gameContainer {
    position: relative;
    width: 640px;
    max-width: 100%;
  }
  video { width: 100%; height: auto; }
  #overlay {
    position: absolute;
    top: 20%;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(0,0,0,0.6);
    padding: 1rem 2rem;
    border-radius: 10px;
    font-size: 1.8rem;
    display: none;
    text-align: center;
  }
  #scoreDisplay, #timerDisplay, #speedMultiplier {
    position: absolute;
    font-size: 14px;
    background: rgba(0,0,0,0.6);
    color: white;
    padding: 5px 8px;
    border-radius: 5px;
  }
  #scoreDisplay { top: 10px; right: 10px; }
  #timerDisplay { top: 10px; left: 10px; }
  #speedMultiplier { top: 35px; right: 10px; }
  #progressDisplay {
    margin-top: 5px;
    font-size: 16px;
    text-align: center;
  }
  #skipBtn, #micBtn {
    margin-top: 10px;
    padding: 10px 20px;
    font-size: 1rem;
    border: none;
    border-radius: 8px;
    background: #ff4444;
    color: white;
    cursor: pointer;
  }
  #skipBtn:hover { background: #cc0000; }
  #micBtn:hover { background: #4444ff; }
</style>
</head>
<body>
<h1>Voice Game: Fruits, Vegetables & Animals üçéü•ïüê∂</h1>

<div id="gameContainer">
  <video id="speedrunVideo" src="speedrun.mp4"></video>
  <div id="overlay"></div>
  <div id="scoreDisplay">Score: 0</div>
  <div id="timerDisplay">Time: 0s</div>
  <div id="speedMultiplier">x1</div>
</div>

<div id="progressDisplay"></div>
<button id="skipBtn">Skip ‚ùå</button>
<button id="micBtn">Reactivate Mic üé§</button>

<script>
const words = [
  "apple","banana","orange","grape","peach","mango","strawberry","cherry","watermelon",
  "carrot","potato","tomato","onion","cucumber","pepper","broccoli","corn","pumpkin",
  "cat","dog","lion","tiger","elephant","monkey","zebra","giraffe","bear","rabbit"
];

// Create short sentence prompts
const sentences = words.map(w => `I see a ${w}`);

function shuffle(array){
  for(let i=array.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1));
    [array[i],array[j]]=[array[j],array[i]];
  }
  return array;
}

let gameWords = shuffle([...sentences]).slice(0,10);
let currentWordIndex = 0;
let score = 0;

const overlay = document.getElementById("overlay");
const scoreDisplay = document.getElementById("scoreDisplay");
const timerDisplay = document.getElementById("timerDisplay");
const speedMultiplierDisplay = document.getElementById("speedMultiplier");
const progressDisplay = document.getElementById("progressDisplay");
const skipBtn = document.getElementById("skipBtn");
const micBtn = document.getElementById("micBtn");
const video = document.getElementById("speedrunVideo");

let startTime = null;
let timerInterval = null;
let recognition = null;

// --- Voice Recognition ---
if('webkitSpeechRecognition' in window){
  recognition = new webkitSpeechRecognition();
  recognition.continuous=false;
  recognition.interimResults=false;
  recognition.lang="en-US";

  recognition.onresult = (event)=>{
    const said = event.results[0][0].transcript.toLowerCase().trim();
    console.log("You said:",said);
    if(said.includes(gameWords[currentWordIndex].split(' ')[2])){ // check the main word
      score +=10;
      updateScoreDisplay();
      nextRound();
    } else {
      overlay.textContent = "Try again: "+gameWords[currentWordIndex];
      setTimeout(()=>recognition.start(),500); // restart quickly
    }
  };

  recognition.onend = ()=>{
    // auto-restart
    if(currentWordIndex<gameWords.length) recognition.start();
  };
}

// --- Timer ---
function startTimer(){
  startTime = Date.now();
  timerInterval = setInterval(()=>{
    const elapsed = Math.floor((Date.now()-startTime)/1000);
    timerDisplay.textContent = `Time: ${elapsed}s`;
    updateMultiplierDisplay();
  },1000);
}

function stopTimer(){ clearInterval(timerInterval); }

// --- Speed Multiplier ---
function calculateSpeedMultiplier(elapsed){
  if(elapsed===0) return 0;
  if(elapsed<=30) return 2;
  if(elapsed<=60) return 1.5;
  if(elapsed<=90) return 1.2;
  return 1;
}

function updateMultiplierDisplay(){
  const elapsed = Math.floor((Date.now()-startTime)/1000);
  speedMultiplierDisplay.textContent = `x${calculateSpeedMultiplier(elapsed)}`;
}

// --- Score ---
function updateScoreDisplay(){ scoreDisplay.textContent=`Score: ${score}`; }

// --- Show Word ---
function showWord(){
  const currentSentence = gameWords[currentWordIndex];
  overlay.textContent=currentSentence;
  overlay.style.display="block";
  skipBtn.style.display="inline-block";
  progressDisplay.textContent=`Word ${currentWordIndex+1} of ${gameWords.length}`;
  if(recognition) recognition.start();
}

// --- Next Round ---
function nextRound(){
  overlay.style.display="none";
  skipBtn.style.display="none";
  currentWordIndex++;
  if(currentWordIndex<gameWords.length){
    playVideoSegment();
  } else { endGame(); }
}

// --- Skip Button ---
skipBtn.addEventListener("click",()=>{
  score=Math.max(0,score-5);
  updateScoreDisplay();
  startTime=Date.now(); // reset multiplier
  speedMultiplierDisplay.textContent="x0";
  nextRound();
});

// --- Reactivate Mic Button ---
micBtn.addEventListener("click",()=>{
  if(recognition) recognition.start();
});

// --- Video Segment ---
function playVideoSegment(){
  video.play();
  setTimeout(()=>{
    video.pause();
    showWord();
  },5000);
}

// --- End Game ---
function endGame(){
  stopTimer();
  const elapsed = Math.floor((Date.now()-startTime)/1000);
  const multiplier = calculateSpeedMultiplier(elapsed);
  const finalScore = Math.round(score*multiplier);

  overlay.textContent="üéâ Game Over!";
  progressDisplay.textContent=`Final Score: ${finalScore} / ${gameWords.length*10} (Time: ${elapsed}s, x${multiplier} speed bonus)`;
  skipBtn.style.display="none";
}

// --- Start Game ---
video.oncanplay = ()=>{
  startTimer();
  playVideoSegment();
};
</script>
</body>
</html>
